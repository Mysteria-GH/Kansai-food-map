<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ç¾é£Ÿç‰¹è¼¯åœ°åœ– äº¬é˜ªver.</title>
    
    <!-- iOS PWA å°ˆç”¨è¨­å®š -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ç¾é£Ÿç‰¹è¼¯åœ°åœ– äº¬é˜ªver.">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/854/854878.png">
    
    <!-- Android PWA / ç€è¦½å™¨å°ˆç”¨è¨­å®š -->
    <meta name="theme-color" content="#ffffff">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="icon" sizes="192x192" href="https://cdn-icons-png.flaticon.com/512/854/854878.png">
    <link rel="shortcut icon" href="https://cdn-icons-png.flaticon.com/512/854/854878.png">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        .btn-active:active { transform: scale(0.98); }
        
        /* å·è»¸å‹•ç•«æ¨£å¼ */
        .accordion-content {
            transition: max-height 0.4s ease-in-out, opacity 0.4s ease-in-out;
            max-height: 0;
            opacity: 0;
            overflow: hidden;
        }
        .accordion-content.open {
            max-height: 600px;
            opacity: 1;
        }

        .filter-section {
            transition: max-height 0.3s ease-in-out, opacity 0.3s ease-in-out, padding 0.3s ease-in-out;
            overflow: hidden;
        }
        .filter-section.closed {
            max-height: 0;
            opacity: 0;
            padding-top: 0;
            padding-bottom: 0;
            border-bottom: none;
        }
        .filter-section.open {
            max-height: 50px;
            opacity: 1;
        }

        /* è½‰å ´å‹•ç•«å±¤æ¨£å¼ */
        .transition-layer {
            position: fixed;
            z-index: 9999;
            pointer-events: none;
            transform-origin: center center;
            border-radius: 50%;
            background-color: transparent;
        }
    </style>
    
    <!-- Leaflet CSS & JS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <!-- React & ReactDOM & Babel -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

    <style>
        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
        .leaflet-container { width: 100%; height: 100%; z-index: 0; }
        body { overscroll-behavior-y: none; -webkit-tap-highlight-color: transparent; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 font-sans h-screen w-screen overflow-hidden">
    <div id="root" class="h-full w-full"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef, useCallback } = React;

        // --- Icons ---
        const IconSearch = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>;
        const IconMapPin = ({className}) => <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>;
        const IconTrash = () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>;
        const IconArrowRight = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>;
        const IconArrowLeft = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>;
        const IconDownload = () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>;
        const IconChevronDown = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>;
        const IconChevronUp = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="18 15 12 9 6 15"></polyline></svg>;
        const IconChevronLeft = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>;
        const IconChevronRight = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>;
        const IconStar = ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>;
        const IconFilter = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon></svg>;
        const IconClock = ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>;
        const IconCopy = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>;

        // --- Constants ---
        const LOCATIONS = {
            kyoto: { name: "äº¬éƒ½è»Šç«™", lat: 34.9858, lng: 135.7588, color: "bg-indigo-600" },
            osaka: { name: "å¤§é˜ªæ¢…ç”°", lat: 34.7025, lng: 135.4958, color: "bg-rose-600" } 
        };

        const OSAKA_SUBLOCATIONS = {
            umeda: { id: 'umeda', name: "æ¢…ç”°", lat: 34.7025, lng: 135.4958 },
            shinsaibashi: { id: 'shinsaibashi', name: "å¿ƒé½‹æ©‹", lat: 34.6723, lng: 135.5013 },
            tennoji: { id: 'tennoji', name: "å¤©ç‹å¯º", lat: 34.6478, lng: 135.5148 },
            osaka_other: { id: 'osaka_other', name: "å…¶å®ƒå€åŸŸ", lat: 34.7025, lng: 135.4958 }
        };

        const KYOTO_SUBLOCATIONS = {
            kyoto_station: { id: 'kyoto_station', name: "äº¬éƒ½è»Šç«™", lat: 34.9858, lng: 135.7588 },
            arashiyama: { id: 'arashiyama', name: "åµ¯å³¨åµå±±è»Šç«™", lat: 35.0191, lng: 135.6778 },
            uji_station: { id: 'uji_station', name: "å®‡æ²»è»Šç«™", lat: 34.8893, lng: 135.8018 },
            kyoto_other: { id: 'kyoto_other', name: "å…¶å®ƒå€åŸŸ", lat: 34.9858, lng: 135.7588 }
        };

        const FOOD_TYPES = [
            { id: 'ramen', label: 'æ‹‰éºµ' },
            { id: 'sukiyaki', label: 'å£½å–œç‡’' },
            { id: 'yakiniku', label: 'ç‡’è‚‰' },
            { id: 'sushi', label: 'å£½å¸' },
            { id: 'ricebowl', label: 'ä¸¼é£¯' },
            { id: 'curry', label: 'å’–å“©' }, 
            { id: 'hamburger', label: 'æ¼¢å ¡æ’' },
            { id: 'eel', label: 'é°»é­š' },
            { id: 'cafe', label: 'å’–å•¡å»³' },
            { id: 'other', label: 'å…¶å®ƒ' }
        ];

        const FILTER_TYPES = [
            { id: 'all', label: 'æ‰€æœ‰ç¨®é¡' },
            ...FOOD_TYPES
        ];

        const DISTANCE_TYPES = [
            { id: 'all', label: 'All' },
            { id: 'near', label: 'â‰¤ 1 KM' },
            { id: 'far', label: '1 KM ~ 2 KM' }
        ];

        // ç‰¹å¾µç¯©é¸
        const SPECIAL_TYPES = [
            { id: 'wagyu', label: 'å’Œç‰›' },
            { id: 'beef_tongue', label: 'ç‰›èˆŒ' },
            { id: 'all_you_can_eat', label: 'åƒåˆ°é£½' },
            { id: 'hamburger', label: 'æ¼¢å ¡æ’' }, 
            { id: 'izakaya', label: 'å±…é…’å±‹' },
            { id: 'lunch', label: 'åˆé–“å¥—é¤' },
            { id: 'kissaten', label: 'å–«èŒ¶' }
        ];

        // --- ç³»çµ±æ¨è–¦åº—é‹ªè³‡æ–™ ---
        const SYSTEM_SHOPS = [
            { id: 1, name: "èŠ±ä¸¸è»’ æ³•å–„å¯ºåº—(é“é “å €+24å°æ™‚+æ¿ƒéƒè±šéª¨é†¬æ²¹+é­¯è±¬äº”èŠ±å‰ç‡’+è’œç‰‡+ç‚’é£¯+ç…é¤ƒ)", displayName: "èŠ±ä¸¸è»’ æ³•å–„å¯ºåº—", lat: 34.6675, lng: 135.5028, category: "osaka", type: ["ramen"], address: "é“é “å €/æ³•å–„å¯º", hours: "24å°æ™‚ç‡Ÿæ¥­", rating: 4.2, reviewCount: 2922 },
            { id: 2, name: "ã—ã‚ƒã¶ã—ã‚ƒã¶ãƒ»ã™ãç„¼ãå°‚é–€åº— ã—ã‚ƒã¶é•·(å¿ƒé½‹æ©‹+ä¸­åˆå¥—é¤+å’Œç‰›å£½å–œç‡’)", displayName: "ã—ã‚ƒã¶é•·", lat: 34.6728, lng: 135.5013, category: "osaka", type: ["sukiyaki"], address: "å¿ƒé½‹æ©‹", hours: "11:30-13:30, 17:30-23:00 (é€±æ—¥å…¬ä¼‘)", rating: 4.3, reviewCount: 152 },
            { id: 3, name: "ãŠé£Ÿäº‹å‡¦ ç¾ç™»é‡Œ(å¤§é˜ªè±¬æ’ä¸¼+é‡å¤§)", displayName: "ãŠé£Ÿäº‹å‡¦ ç¾ç™»é‡Œ", lat: 34.6695, lng: 135.5496, category: "osaka", type: ["ricebowl"], address: "å¤§é˜ªæ±æˆå€", hours: "11:00-19:00 (é€±äºŒå…¬ä¼‘)", rating: 4.5, reviewCount: 192 },
            { id: 4, name: "Melt Chocolate(å¿ƒé½‹æ©‹+ç¾åˆ‡ç†±å·§å…‹åŠ›)", displayName: "Melt Chocolate", lat: 34.6775, lng: 135.4993, category: "osaka", type: ["cafe", "other"], address: "å¿ƒé½‹æ©‹/å—èˆ¹å ´", hours: "11:00-20:00", rating: 4.6, reviewCount: 85 },
            { id: 5, name: "å¤§é˜ªç‡’ åƒæˆ¿(é“é “å €)", displayName: "åƒæˆ¿ é“é “å €", lat: 34.6685, lng: 135.5035, category: "osaka", type: ["other"], address: "é“é “å €", hours: "11:00-23:00", rating: 4.0, reviewCount: 2100 },
            { id: 6, name: "è‚‰ã®éš ã‚Œå®¶ ãŠã‚ãŒã‚Š åµå±±æœ¬åº—(å’Œç‰›ç«å±±+æ¡‚å·é¢¨æ™¯)", displayName: "è‚‰ã®éš ã‚Œå®¶ ãŠã‚ãŒã‚Š", lat: 35.0116, lng: 135.6766, category: "kyoto", type: ["ricebowl", "other"], address: "åµå±±", hours: "11:00-15:00", rating: 4.4, reviewCount: 620 },
            { id: 7, name: "ã™ãã‚„ããƒ»ã—ã‚ƒã¶ã—ã‚ƒã¶å¤§ç‰§å ´ åƒæ—¥å‰åº—(é›£æ³¢ç«™+ç¥æˆ¶å’Œç‰›å£½å–œç‡’åƒåˆ°é£½)", displayName: "å¤§ç‰§å ´ åƒæ—¥å‰åº—", lat: 34.6667, lng: 135.5042, category: "osaka", type: ["sukiyaki"], address: "åƒæ—¥å‰/é›£æ³¢", hours: "11:00-15:00, 17:00-23:00", rating: 4.1, reviewCount: 880 },
            { id: 8, name: "ç„¼è‚‰ã“ã˜ã¾é›¢ã‚Œ å¤§é˜ªæ±Ÿå‚(æ¼¢å ¡æ’)", displayName: "ç„¼è‚‰ã“ã˜ã¾é›¢ã‚Œ", lat: 34.7595, lng: 135.4965, category: "osaka", type: ["yakiniku", "hamburger"], address: "æ±Ÿå‚", hours: "11:30-14:30, 17:00-23:00", rating: 4.3, reviewCount: 340 },
            { id: 9, name: "åšåˆ‡ã‚Šä»™å°ç‰›ã‚¿ãƒ³ã¨é»’æ¯›å’Œç‰›é£Ÿã¹æ”¾é¡Œ ç„¼è‚‰å€¶æ¥½éƒ¨ æ¢…ç”°åº—", displayName: "ç„¼è‚‰å€¶æ¥½éƒ¨ æ¢…ç”°åº—", lat: 34.7035, lng: 135.5000, category: "osaka", type: ["yakiniku"], address: "æ¢…ç”°", hours: "16:00-23:00", rating: 3.9, reviewCount: 120 },
            { id: 10, name: "ã—ã‚ƒã¶ç¦… æ¢…ç”°åº—(é»‘æ¯›å’Œç‰›å£½å–œç‡’åƒåˆ°é£½)", displayName: "ã—ã‚ƒã¶ç¦… æ¢…ç”°åº—", lat: 34.7005, lng: 135.4965, category: "osaka", type: ["sukiyaki"], address: "æ¢…ç”°", hours: "11:30-14:30, 17:00-22:30", rating: 4.1, reviewCount: 550 },
            { id: 11, name: "ç„¼è‚‰ã‚¸ãƒ£ãƒ‘ãƒ³ LINKS UMEDAåº—(æ¢…ç”°+ç¥æˆ¶ç‰›)", displayName: "ç„¼è‚‰ã‚¸ãƒ£ãƒ‘ãƒ³", lat: 34.7050, lng: 135.4970, category: "osaka", type: ["yakiniku"], address: "LINKS UMEDA", hours: "11:00-23:00", rating: 4.2, reviewCount: 230 },
            { id: 12, name: "ã™ãç„¼ ã—ã‚ƒã¶ã—ã‚ƒã¶ã¤ã‹ã  KITTEå¤§é˜ª(æ¢…ç”°kitteç™¾è²¨+é—œè¥¿å’Œç‰›å£½å–œç‡’)", displayName: "ã™ãç„¼ ã—ã‚ƒã¶ã—ã‚ƒã¶ã¤ã‹ã ", lat: 34.7015, lng: 135.4945, category: "osaka", type: ["sukiyaki"], address: "KITTEå¤§é˜ª", hours: "11:00-15:00, 17:00-23:00", rating: 4.5, reviewCount: 238 },
            { id: 13, name: "å’Œç‰›ä¸€é ­è²·ã„ ç„¼è‚‰ãƒ›ãƒ«ãƒ¢ãƒ³é»’é‡ ã‚¦ãƒ©ãªã‚“ã°æœ¬åº—(é›£æ³¢+é»‘æ¯›å’Œç‰›)", displayName: "ç„¼è‚‰ãƒ›ãƒ«ãƒ¢ãƒ³é»’é‡", lat: 34.6645, lng: 135.5030, category: "osaka", type: ["yakiniku"], address: "è£é›£æ³¢", hours: "17:00-24:00", rating: 4.3, reviewCount: 180 },
            { id: 14, name: "æ‰‹ã¥ãã‚Šãƒãƒ³ãƒãƒ¼ã‚°ã®åº— ã¨ãã‚‰ äº¬éƒ½ä¸‰æ¡åº—(Juicy Hamburger Steak+ãƒ«ã‚¯ã‚¢å¤§é˜ªä¹Ÿæœ‰)", displayName: "ã¨ãã‚‰ äº¬éƒ½ä¸‰æ¡åº—", lat: 35.0089, lng: 135.7681, category: "kyoto", type: ["hamburger"], address: "äº¬éƒ½ä¸‰æ¡", hours: "11:00-15:00, 17:00-22:00 (é€±ä¸‰å…¬ä¼‘)", rating: 4.2, reviewCount: 1500 },
            { id: 15, name: "æ¿å‰ç„¼è‚‰ ä¸€å…‰ ä½ä¹‹æ±Ÿæœ¬åº—(é»‘æ¯›å’Œç‰›)", displayName: "æ¿å‰ç„¼è‚‰ ä¸€å…‰", lat: 34.6094, lng: 135.4735, category: "osaka", type: ["yakiniku"], address: "ä½ä¹‹æ±Ÿ", hours: "17:00-23:00 (é€±äºŒå…¬ä¼‘)", rating: 4.4, reviewCount: 90 },
            { id: 16, name: "TAKUMEAT STORE(æ–°å¤§é˜ªç«™+ç‡’è‚‰)", displayName: "TAKUMEAT STORE", lat: 34.7335, lng: 135.5003, category: "osaka", type: ["yakiniku"], address: "æ–°å¤§é˜ª", hours: "11:00-22:00", rating: 4.6, reviewCount: 50 },
            { id: 17, name: "åœ°ç„¼ã†ãªã æ³•å–„å¯ºå±±ã‹ã¥(é›£æ³¢ç«™+é—œè¥¿åœ°ç‡’é°»é­šé£¯)", displayName: "æ³•å–„å¯ºå±±ã‹ã¥", lat: 34.6672, lng: 135.5020, category: "osaka", type: ["eel", "ricebowl"], address: "æ³•å–„å¯º", hours: "11:00-15:00, 17:00-21:00", rating: 4.6, reviewCount: 239 },
            { id: 18, name: "é»„é‡‘å‡ºæ±ã—ã‚ƒã¶ã¨æ±Ÿæˆ¸å‰å¯¿å¸ è‚‰ã®ã‚ã•ã¤ æ¢…ç”°ãŠåˆå¤©ç¥åº—(æ¢…ç”°+é»‘æ¯›å’Œç‰›å£½å–œç‡’å®šé£Ÿ+å…è²»ç™½é£¯?+ç‰¹å®šæ™‚é–“)", displayName: "è‚‰ã®ã‚ã•ã¤", lat: 34.7000, lng: 135.5015, category: "osaka", type: ["sukiyaki", "sushi"], address: "æ¢…ç”°ãŠåˆå¤©ç¥", hours: "12:00-23:00", rating: 4.0, reviewCount: 310 },
            { id: 19, name: "ã‚¹ã‚­ãƒ¤ã‚­ãƒ•ã‚¸ã‚ª ãªã‚“ã°CITYåº—(é›£æ³¢+å€‹äººå£½å–œç‡’)", displayName: "ã‚¹ã‚­ãƒ¤ã‚­ãƒ•ã‚¸ã‚ª", lat: 34.6642, lng: 135.5025, category: "osaka", type: ["sukiyaki"], address: "é›£æ³¢CITY", hours: "11:00-22:00", rating: 3.8, reviewCount: 150 },
            { id: 20, name: "ç„¼è‚‰ã”ã‚Šã¡ã‚ƒã‚“ãŠåˆå¤©ç¥åº—(æ±æ¢…ç”°+é»‘æ¯›å’Œç‰›)", displayName: "ç„¼è‚‰ã”ã‚Šã¡ã‚ƒã‚“", lat: 34.7010, lng: 135.5010, category: "osaka", type: ["yakiniku"], address: "æ±æ¢…ç”°", hours: "17:00-07:00 (éš”æ—¥)", rating: 4.7, reviewCount: 850 },
            { id: 21, name: "CAFE ANNON ãªã‚“ã°æœ¬åº—(é›£æ³¢+é¬†é¤…?)", displayName: "CAFE ANNON", lat: 34.6660, lng: 135.5035, category: "osaka", type: ["cafe", "other"], address: "é›£æ³¢", hours: "11:00-23:00", rating: 4.2, reviewCount: 450 },
            { id: 22, name: "å’Œç‰›å°‚é–€ ç‰›ã‚ã— å‰ç”°å„ª(é›£æ³¢+A5å’Œç‰›+ç‰›ä¸¼)", displayName: "å’Œç‰›å°‚é–€ ç‰›ã‚ã— å‰ç”°å„ª", lat: 34.6670, lng: 135.5060, category: "osaka", type: ["ricebowl"], address: "åƒæ—¥å‰/æ—¥æœ¬æ©‹", hours: "11:30-16:00, 17:00-22:30", rating: 4.3, reviewCount: 120 },
            { id: 23, name: "é‡œé£¯ã¨æµ·é®® æš(å¿ƒé½‹æ©‹+å‰µä½œæµ·é®®+æµ·é®®é‡œé£¯)", displayName: "é‡œé£¯ã¨æµ·é®® æš", lat: 34.6735, lng: 135.5020, category: "osaka", type: ["ricebowl", "other"], address: "å¿ƒé½‹æ©‹", hours: "11:30-15:00, 17:00-23:00", rating: 4.1, reviewCount: 200 },
            { id: 24, name: "ã‹ã¤ä¸¼ åƒä»£æ¾è±ªä»(å››ãƒ„æ©‹é§…)", displayName: "ã‹ã¤ä¸¼ åƒä»£æ¾è±ªä»", lat: 34.6729, lng: 135.4966, category: "osaka", type: ["ricebowl"], address: "å››ãƒ„æ©‹", hours: "11:00-15:00, 17:30-21:30", rating: 3.8, reviewCount: 4454 },
            { id: 25, name: "åšåˆ‡ã‚Šä»™å°ç‰›ã‚¿ãƒ³ã¨é»’æ¯›å’Œç‰›é£Ÿã¹æ”¾é¡Œ ç„¼è‚‰å€¶æ¥½éƒ¨ å¤©ç‹å¯ºåº—", displayName: "ç„¼è‚‰å€¶æ¥½éƒ¨ å¤©ç‹å¯ºåº—", lat: 34.6478, lng: 135.5148, category: "osaka", type: ["yakiniku"], address: "å¤©ç‹å¯º", hours: "16:00-23:00", rating: 4.0, reviewCount: 80 },
            { id: 26, name: "ï¼ƒKOKUBAN (ã‚³ã‚¯ãƒãƒ³)(æ­å§†é£¯+æ¼¢å ¡æ’)", displayName: "KOKUBAN", lat: 34.6650, lng: 135.5000, category: "osaka", type: ["hamburger", "other"], address: "é›£æ³¢/å¿ƒé½‹æ©‹", hours: "11:30-15:00, 17:30-22:00", rating: 3.9, reviewCount: 60 },
            { id: 27, name: "ç„¼ãé³¥ ãŠã§ã‚“ åŠã£ã¡ã‚ƒã‚“èŒ¶å±‹ç”ºåº—(æ¢…ç”°+å¹³åƒ¹ä¸²ç‡’+æ˜­å’Œé¢¨?)", displayName: "åŠã£ã¡ã‚ƒã‚“èŒ¶å±‹ç”ºåº—", lat: 34.7070, lng: 135.4990, category: "osaka", type: ["other"], address: "æ¢…ç”°èŒ¶å±‹ç”º", hours: "17:00-23:00", rating: 3.7, reviewCount: 150 },
            { id: 28, name: "ç„¼è‚‰ ã‚èˆŒ æ³•å–„å¯º(åˆé–“å®šé£Ÿ+ç‰›è“‹é£¯+èŒ¶æ³¡é£¯+åŒ…é–“)", displayName: "ç„¼è‚‰ ã‚èˆŒ", lat: 34.6675, lng: 135.5030, category: "osaka", type: ["yakiniku", "ricebowl"], address: "æ³•å–„å¯º", hours: "11:00-15:00, 17:00-23:00", rating: 4.3, reviewCount: 110 },
            { id: 29, name: "å¸°ã£ã¦ããŸ å®®ç”°éººå…(æ²¾éºµ)", displayName: "å¸°ã£ã¦ããŸ å®®ç”°éººå…", lat: 34.6720, lng: 135.5035, category: "osaka", type: ["ramen"], address: "å¿ƒé½‹æ©‹", hours: "11:00-16:00, 17:30-22:00", rating: 3.9, reviewCount: 800 },
            { id: 30, name: "ã¾ã‚‹ã‚ˆã—(æœ¨æ´¥å£½å¸)", displayName: "ã¾ã‚‹ã‚ˆã—", lat: 34.6569, lng: 135.4984, category: "osaka", type: ["sushi"], address: "æœ¨æ´¥å¸‚å ´", hours: "05:00-13:00 (é€±ä¸‰/é€±æ—¥å…¬ä¼‘)", rating: 4.4, reviewCount: 391 },
            { id: 31, name: "ç„¼è‚‰ã†ã—ã”ã‚ æ¢…ç”°åº—(å’Œç‰›ç‡’è‚‰+å…¨ç¨‹ä»£çƒ¤)", displayName: "ç„¼è‚‰ã†ã—ã”ã‚", lat: 34.7040, lng: 135.4960, category: "osaka", type: ["yakiniku"], address: "æ¢…ç”°", hours: "11:30-15:00, 17:00-23:30", rating: 4.5, reviewCount: 80 },
            { id: 32, name: "å¤§å’ŒèŒ¶å¤§ç¦å°ˆé–€åº— GRAN CHA(å¥ˆè‰¯+å¤§ç¦)", displayName: "GRAN CHA", lat: 34.6815, lng: 135.8290, category: "osaka", type: ["cafe", "other"], address: "å¥ˆè‰¯", hours: "10:00-19:00", rating: 4.2, reviewCount: 150 },
            { id: 33, name: "ä¸­è°·å ‚(å¥ˆè‰¯+è‰¾è‰éº»ç³¬)", displayName: "ä¸­è°·å ‚", lat: 34.6820, lng: 135.8298, category: "osaka", type: ["other"], address: "å¥ˆè‰¯", hours: "10:00-19:00", rating: 4.4, reviewCount: 3000 },
            { id: 34, name: "ä¸‰å¤§å’Œç‰›é£Ÿã¹æ¯”ã¹ ç„¼è‚‰ ã¤ãªã(é›£æ³¢+å€‹å®¤ç‡’è‚‰+ç¥æˆ¶ç‰›)", displayName: "ç„¼è‚‰ ã¤ãªã", lat: 34.6660, lng: 135.5020, category: "osaka", type: ["yakiniku"], address: "é›£æ³¢", hours: "17:00-23:00", rating: 4.6, reviewCount: 150 },
            { id: 35, name: "ã™ãç„¼ã ã—ã‚ƒã¶ã—ã‚ƒã¶ è‚‰å¯¿å¸ é£Ÿã¹æ”¾é¡Œ å’Œç‰›ã–ã‚“ã¾ã„ å¿ƒæ–æ©‹åº—(å®®å´ç‰›å£½å–œç‡’+ä¸²ç‡’+åƒåˆ°é£½+å››ç¨®å¥—é¤)", displayName: "å’Œç‰›ã–ã‚“ã¾ã„", lat: 34.6715, lng: 135.5015, category: "osaka", type: ["sukiyaki", "sushi"], address: "å¿ƒé½‹æ©‹", hours: "16:00-23:00", rating: 4.0, reviewCount: 110 },
            { id: 36, name: "ã™ãç„¼ããƒ»ã—ã‚ƒã¶ã—ã‚ƒã¶ ãã‚ˆåŠ©(å€‹äººé‹)", displayName: "ãã‚ˆåŠ©", lat: 34.6690, lng: 135.5010, category: "osaka", type: ["sukiyaki"], address: "é›£æ³¢", hours: "17:00-23:00", rating: 4.1, reviewCount: 80 },
            { id: 37, name: "å¤§é˜ªç¦å³¶ WAgyué¬¼ã ç„¼è‚‰(æ–°ç¦å³¶ç«™+é»‘æ¯›å’Œç‰›+å†·éºµ)", displayName: "WAgyué¬¼ã", lat: 34.6967, lng: 135.4800, category: "osaka", type: ["yakiniku"], address: "ç¦å³¶", hours: "17:00-24:00", rating: 4.4, reviewCount: 90 },
            { id: 38, name: "äººé¡ã¿ãªéºµé¡(æ‡‰è©²æ˜¯é€™å®¶?+è¥¿ä¸­å³¶+18~22+ç‚’é£¯+é†¬æ²¹æ‹‰éºµ+é®­é­šåµ)", displayName: "äººé¡ã¿ãªéºµé¡", lat: 34.7262, lng: 135.5005, category: "osaka", type: ["ramen"], address: "è¥¿ä¸­å³¶å—æ–¹", hours: "10:00-03:00 (éš”æ—¥)", rating: 4.3, reviewCount: 3500 },
            { id: 39, name: "ç‰›èˆŒçš„æŸ æª¬(è¶…åšç¢³çƒ¤ç‰›èˆŒ+ç‰›èˆŒå¾Œæ®µ[è»Ÿå«©]+å‘³å™Œé†¬+æª¸æª¬é£²+å’–å“©ç‰›èˆŒ+å…è²»çºŒé£¯)", displayName: "ç‰›ãŸã‚“ã®æª¸æª¬ å¤§é˜ª", lat: 34.6665, lng: 135.5040, category: "osaka", type: ["yakiniku"], address: "é›£æ³¢/æ—¥æœ¬æ©‹", hours: "11:30-15:00, 17:00-22:00", rating: 4.8, reviewCount: 975 },
            { id: 40, name: "ã‚„ã•ã„ä¸²å·»ã ãªã‚‹ã¨ã‚„(æ‡‰è©²æ˜¯é€™å®¶?+é‡èœæ²+å±…é…’å±‹)", displayName: "ãªã‚‹ã¨ã‚„", lat: 34.6680, lng: 135.5025, category: "osaka", type: ["other"], address: "é›£æ³¢", hours: "17:00-24:00", rating: 4.0, reviewCount: 220 },
            { id: 41, name: "MooM Cafe(èˆ’èŠ™è•¾ç…é¤…)", displayName: "MooM Cafe", lat: 34.8517, lng: 135.6178, category: "osaka", type: ["cafe", "other"], address: "é«˜æ§»", hours: "11:00-18:00 (é€±ä¸€å…¬ä¼‘)", rating: 4.3, reviewCount: 240 },
            { id: 42, name: "é»’æ¯›å’Œç‰›ã‚¿ãƒ³ã¨ãƒãƒ©ãƒŸ ç„¼è‚‰é¾ é›£æ³¢åƒæ—¥å‰åº—(é»‘æ¯›å’Œç‰›ç‡’è‚‰+èƒèŸ¹æµ·é®®+åƒåˆ°é£½)", displayName: "ç„¼è‚‰é¾", lat: 34.6655, lng: 135.5038, category: "osaka", type: ["yakiniku"], address: "åƒæ—¥å‰", hours: "16:00-24:00", rating: 4.2, reviewCount: 150 },
            { id: 43, name: "ã‚ã‚“å‡¦ ã¤ã‚‹ã¯ã‚“ KITTEå¤§é˜ªåº—(è¥¿æ¢…ç”°ç«™+é»‘æ¯›å’Œç‰›+å£½å–œç‡’çƒé¾éºµ)", displayName: "ã‚ã‚“å‡¦ ã¤ã‚‹ã¯ã‚“", lat: 34.7015, lng: 135.4945, category: "osaka", type: ["sukiyaki", "other"], address: "KITTEå¤§é˜ª", hours: "11:00-23:00", rating: 5.0, reviewCount: 20 },
            { id: 44, name: "ãƒ‘ãƒ³ã¨ã‚¨ã‚¹ãƒ—ãƒ¬ãƒƒã‚½ã¨å ºç­‹ä¿±æ¥½éƒ¨(Brunch+ç™¾å¹´éŠ€è¡Œ+éºµåŒ…å’–å•¡å»³+ä¸€å€‹æœˆå‰é ç´„)", displayName: "å ºç­‹ä¿±æ¥½éƒ¨", lat: 34.6750, lng: 135.5065, category: "osaka", type: ["cafe", "other"], address: "å ºç­‹", hours: "08:00-20:00", rating: 4.1, reviewCount: 850 },
            { id: 45, name: "ã‚‰ãƒ¼ã‚ã‚“å¿—é«˜(è±šéª¨+ç‚’é£¯+åº§ä½å°‘)", displayName: "ã‚‰ãƒ¼ã‚ã‚“å¿—é«˜", lat: 34.6019, lng: 135.4920, category: "osaka", type: ["ramen"], address: "ä½å‰", hours: "11:00-15:00, 18:00-20:30 (é€±ä¸‰/å››å…¬ä¼‘)", rating: 4.4, reviewCount: 50 },
            { id: 46, name: "The 33 Teaï¼†Bar Terrace(æ¢…ç”°+çµ•æ™¯+æ­å§†é£¯+åˆé–“å¥—é¤)", displayName: "The 33", lat: 34.6995, lng: 135.4930, category: "osaka", type: ["cafe", "other"], address: "è¥¿æ¢…ç”°", hours: "11:00-23:00", rating: 4.1, reviewCount: 189 },
            { id: 47, name: "é¶Soba åº§éŠ€ æœ¬åº—(åœ°é»ç‚ºå¤§ç‰ˆæœ¬åº—+é€£çµç‚ºæ±äº¬æœ¬åº—)", displayName: "é¶Soba åº§éŠ€ æœ¬åº—", lat: 34.6885, lng: 135.4940, category: "osaka", type: ["ramen"], address: "è‚¥å¾Œæ©‹", hours: "11:00-22:30", rating: 4.4, reviewCount: 3000 },
            { id: 48, name: "Gion Duck Rice(å¾…ç™¼ç¾)", displayName: "Gion Duck Rice", lat: 35.0037, lng: 135.7778, category: "kyoto", type: ["ricebowl"], address: "ç¥‡åœ’", hours: "11:00-15:00, 17:30-21:30", rating: 4.4, reviewCount: 596 },
            { id: 49, name: "ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒƒãƒ— ãƒ€ãƒ¼ãƒ«(æ­é¢¨å’–å“©+å°èœ)", displayName: "ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒƒãƒ— ãƒ€ãƒ¼ãƒ«", lat: 34.6850, lng: 135.5165, category: "osaka", type: ["curry"], address: "è°·ç”ºå››ä¸ç›®", hours: "11:00-20:00 (é€±æ—¥å…¬ä¼‘)", rating: 4.2, reviewCount: 120 },
            { id: 50, name: "ç‚­ãƒˆç¾½é‡œ ã©ã’ã‚“(è¦ªå­ä¸¼+ç‡’è‚‰)", displayName: "ç‚­ãƒˆç¾½é‡œ ã©ã’ã‚“", lat: 34.6455, lng: 135.5150, category: "osaka", type: ["ricebowl", "yakiniku"], address: "å¤©ç‹å¯º/é˜¿å€é‡", hours: "17:00-24:00 (é€±æœ«åˆé¤ 11:30-14:00)", rating: 4.5, reviewCount: 40 },
            { id: 51, name: "é°»å±‹ ç€¬ãŒã‚(çƒä¸¸+ç”ºå®¶+é°»é­šé£¯)", displayName: "é°»å±‹ ç€¬ãŒã‚", lat: 35.0045, lng: 135.7595, category: "kyoto", type: ["eel"], address: "çƒä¸¸", hours: "11:00-14:00, 17:00-21:30", rating: 4.3, reviewCount: 110 },
            { id: 52, name: "å¤§é˜ªç„¼è‚‰ ç„¼è‚‰Lab é›£æ³¢åº—(åƒåˆ°é£½)", displayName: "ç„¼è‚‰Lab é›£æ³¢åº—", lat: 34.6658, lng: 135.5015, category: "osaka", type: ["yakiniku"], address: "é›£æ³¢", hours: "17:00-23:00 (é€±æœ« 12:00-23:00)", rating: 4.7, reviewCount: 200 },
            { id: 55, name: "ãŠæ™©é…Œ èŠ½(æ¢…ç”°+å’Œç‰›+å±…é…’å±‹)", displayName: "ãŠæ™©é…Œ èŠ½", lat: 34.7005, lng: 135.5030, category: "osaka", type: ["izakaya"], address: "æ¢…ç”°", hours: "17:00-05:00", rating: 4.5, reviewCount: 15 },
            { id: 56, name: "å±‹å°é¤ƒå­(å±…é…’å±‹+ä¸ç”¨å¤§è’œ)", displayName: "å±‹å°é¤ƒå­ ã‚ã‚‰ã", lat: 34.7024, lng: 135.4959, category: "osaka", type: ["izakaya", "other"], address: "æ¢…ç”°Whity", hours: "11:00-23:00", rating: 4.0, reviewCount: 220 },
            { id: 57, name: "ã€’530-0018 Osaka, Kita Ward, KomatsubarachÅ, 1 ãƒ¢ã‚³ãƒ“ãƒ«(ç‰¡è £ã )", displayName: "ã‹ãéµ", lat: 34.7020, lng: 135.5010, category: "osaka", type: ["izakaya", "other"], address: "æ¢…ç”°", hours: "17:00-23:00", rating: 4.2, reviewCount: 80 },
            { id: 58, name: "ãƒ¢ãƒªã‚¿å±‹ å››æ¡çŒªç†Šæœ¬åº—(å¤§é˜ªä¹Ÿæœ‰+150å¹´é—œè¥¿å’Œç‰›å£½å–œç‡’+å…¨ç¨‹å°ˆäººæœå‹™+5ç¨®åƒ¹ä½å¥—é¤)", displayName: "ãƒ¢ãƒªã‚¿å±‹ å››æ¡çŒªç†Šæœ¬åº—", lat: 35.0039, lng: 135.7485, category: "kyoto", type: ["sukiyaki"], address: "å››æ¡å¤§å®®", hours: "11:30-14:30, 17:00-22:00", rating: 4.4, reviewCount: 950 },
            { id: 59, name: "ç„¼è‚‰è—¤ã‚‚ã¨ å¿ƒæ–æ©‹åº—(ç¦å³¶ååº—ç‡’è‚‰+è›‹)", displayName: "ç„¼è‚‰è—¤ã‚‚ã¨ å¿ƒæ–æ©‹åº—", lat: 34.6705, lng: 135.5050, category: "osaka", type: ["yakiniku"], address: "å¿ƒé½‹æ©‹", hours: "17:00-23:00", rating: 4.8, reviewCount: 60 },
            { id: 60, name: "ä¸¸æ­£é¤ƒå­åº— é˜ªå¥ˆåº—(æœ¬åº—åœ¨é™„è¿‘+ä¸­è¯æ–™ç†)", displayName: "ä¸¸æ­£é¤ƒå­åº— é˜ªå¥ˆåº—", lat: 34.7030, lng: 135.6170, category: "osaka", type: ["other"], address: "å¤§æ±å¸‚", hours: "16:00-22:00", rating: 4.1, reviewCount: 450 },
            { id: 61, name: "åŠ›ä¸¸ ç‚‰ã°ãŸç„¼ é¦¬ç± (çˆç«¯ç‡’)", displayName: "åŠ›ä¸¸ ç‚‰ã°ãŸç„¼ é¦¬ç± ", lat: 34.7065, lng: 135.4985, category: "osaka", type: ["izakaya"], address: "æ¢…ç”°", hours: "16:00-23:00", rating: 4.0, reviewCount: 320 },
            { id: 62, name: "ã¾ãã® å¤©ç¥æ©‹å››ä¸ç›®åº—(å¤©å©¦ç¾…+ä¸¼)", displayName: "ã¾ãã® å¤©ç¥æ©‹å››ä¸ç›®åº—", lat: 34.7055, lng: 135.5115, category: "osaka", type: ["ricebowl", "other"], address: "å¤©æ»¿", hours: "11:00-22:00", rating: 4.3, reviewCount: 1100 },
            { id: 63, name: "é›Œç‰›å°‚é–€åº— æ¿å‰ç„¼è‚‰ä¸€ç‰› å¿ƒæ–æ©‹åº—(å„åœ°å’Œç‰›)", displayName: "æ¿å‰ç„¼è‚‰ä¸€ç‰› å¿ƒæ–æ©‹åº—", lat: 34.6730, lng: 135.5010, category: "osaka", type: ["yakiniku"], address: "å¿ƒé½‹æ©‹", hours: "17:00-23:00", rating: 4.6, reviewCount: 220 },
            { id: 64, name: "ã‚¤ãƒ³ã‚»ãƒ—ã‚·ãƒ§ãƒ³ å¤§é˜ª(å†°ç£šå’–å•¡+äº¬éƒ½ä¹Ÿæœ‰)", displayName: "Inception Osaka", lat: 34.7035, lng: 135.5030, category: "osaka", type: ["cafe"], address: "æ¢…ç”°", hours: "14:00-23:00", rating: 4.5, reviewCount: 150 },
            { id: 65, name: "Kusaka Curry(ä¸ƒå€‹ä½ç½®)", displayName: "Kusaka Curry", lat: 34.6780, lng: 135.5005, category: "osaka", type: ["curry"], address: "å—èˆ¹å ´", hours: "11:30-15:00", rating: 4.4, reviewCount: 280 },
            { id: 66, name: "å¯¿ã—ã®ã‚€ã•ã— äº¬éƒ½é§…å…«æ¡å£åº—(å£½å¸)", displayName: "å¯¿ã—ã®ã‚€ã•ã— äº¬éƒ½é§…å…«æ¡å£åº—", lat: 34.9845, lng: 135.7590, category: "kyoto", type: ["sushi"], address: "äº¬éƒ½è»Šç«™", hours: "10:30-21:45", rating: 4.1, reviewCount: 1800 },
            { id: 67, name: "Japanese Noodle ä¸€å¯¸æ³•å¸«(æ‹‰éºµ)", displayName: "Japanese Noodle ä¸€å¯¸æ³•å¸«", lat: 34.9965, lng: 135.7790, category: "kyoto", type: ["ramen"], address: "æ¸…æ°´äº”æ¡", hours: "11:00-16:00", rating: 4.3, reviewCount: 450 },
            { id: 68, name: "é³¥å²©æ¥¼(è¦ªå­ä¸¼)", displayName: "è¥¿é™£ é³¥å²©æ¥¼", lat: 35.0295, lng: 135.7485, category: "kyoto", type: ["ricebowl"], address: "è¥¿é™£", hours: "12:00-14:00, 17:00-20:00", rating: 4.2, reviewCount: 1200 },
            { id: 69, name: "ä»™è±†ï¼ˆã‚»ãƒ³ã‚ºï¼‰(æ—¥æœ¬æ©‹+ç‚¸è±¬æ’?)", displayName: "ä»™è±†", lat: 34.6675, lng: 135.5075, category: "osaka", type: ["ricebowl"], address: "æ—¥æœ¬æ©‹", hours: "11:00-15:00, 17:00-23:00", rating: 4.6, reviewCount: 85 },
            { id: 70, name: "èŒ¶å¯® å¯¶æ³‰(å’Œè“å­é¤å»³+å–«èŒ¶)", displayName: "èŒ¶å¯® å¯¶æ³‰", lat: 35.0450, lng: 135.7725, category: "kyoto", type: ["kissaten", "cafe"], address: "ä¸‹é´¨", hours: "10:00-17:00", rating: 4.5, reviewCount: 800 },
            { id: 71, name: "é®èŒ¶å±‹å¹³é‡å±‹(å–«èŒ¶)", displayName: "å¹³é‡å±‹", lat: 35.0270, lng: 135.6605, category: "kyoto", type: ["kissaten", "other"], address: "æ„›å®•å±±", hours: "11:30-21:00", rating: 4.5, reviewCount: 300 },
            { id: 72, name: "Bread, Espresso & åµå±±åº­åœ’(å’–å•¡å»³+å–«èŒ¶)", displayName: "Bread, Espresso & åµå±±åº­åœ’", lat: 35.0135, lng: 135.6740, category: "kyoto", type: ["cafe", "kissaten"], address: "åµå±±", hours: "08:00-18:00", rating: 4.2, reviewCount: 1500 },
            { id: 73, name: "ç”˜å‘³ã©ã“ã‚ ãã‚’ã‚“ å°æ£®(å’Œè“å­é¤å»³+å–«èŒ¶)", displayName: "ãã‚’ã‚“ å°æ£®", lat: 35.0060, lng: 135.7735, category: "kyoto", type: ["kissaten", "cafe"], address: "ç¥‡åœ’", hours: "11:00-20:00 (é€±ä¸‰å…¬ä¼‘)", rating: 4.3, reviewCount: 1200 },
            { id: 74, name: "éº“å¯¿åºµ(å’–å•¡å»³+å–«èŒ¶)", displayName: "éº“å¯¿åºµ", lat: 35.0070, lng: 135.7605, category: "kyoto", type: ["cafe", "kissaten"], address: "å…­è§’", hours: "11:00-18:00", rating: 4.6, reviewCount: 350 },
            { id: 75, name: "æ­é¢¨æ–™ç† é‡äº­(æ¼¢å ¡æ’)", displayName: "é‡äº­", lat: 34.6655, lng: 135.5015, category: "osaka", type: ["hamburger"], address: "é›£æ³¢", hours: "11:30-15:00, 17:00-20:00", rating: 4.1, reviewCount: 1500 },
            { id: 76, name: "æŸ³å°è·¯(é›£æ³¢+äº¬éƒ½æœ‰æ›´å¤šå®¶+å±…é…’å±‹+æ¼¢å ¡æ’)", displayName: "æŸ³å°è·¯", lat: 34.6650, lng: 135.5010, category: "osaka", type: ["izakaya", "hamburger"], address: "é›£æ³¢", hours: "17:00-23:00", rating: 4.2, reviewCount: 400 },
            { id: 77, name: "è•éº¥éºµ åµå±±ã‚ˆã—ã‚€ã‚‰(180åº¦è§€æ™¯+ç´…è‘‰å­£+å¯èƒ½è¦æ’éšŠ)", displayName: "åµå±±ã‚ˆã—ã‚€ã‚‰", lat: 35.0145, lng: 135.6775, category: "kyoto", type: ["other"], address: "åµå±±", hours: "11:00-17:00", rating: 4.3, reviewCount: 1800 },
            { id: 78, name: "è‚‰ã®å¤©æº€å±‹ ç¥æ¥½äº­(é»‘æ¯›å’Œç‰›å¥—é¤)", displayName: "è‚‰ã®å¤©æº€å±‹ ç¥æ¥½äº­", lat: 34.7065, lng: 135.5125, category: "osaka", type: ["yakiniku"], address: "å¤©æ»¿", hours: "17:00-23:00", rating: 4.6, reviewCount: 120 },
            { id: 79, name: "ã‚ã‚“æ¬¡éƒ(æ¢…ç”°+çƒé¾éºµ+å¥—é¤å…è²»ç™½é£¯+ä½ç½®å°‘)", displayName: "ã‚ã‚“æ¬¡éƒ", lat: 34.7015, lng: 135.4965, category: "osaka", type: ["other"], address: "æ¢…ç”°", hours: "11:00-21:00", rating: 4.0, reviewCount: 350 },
            { id: 80, name: "ç‚­ç«ç„¼ãé³¥ é´¨å°½ ãŠåˆå¤©ç¥åº—(ç‡’è‚‰+è¿‘æ±Ÿé´¨+å¤§å’Œè‚‰é›+2025é³¥æ–™ç†ç™¾ååº—)", displayName: "ç‚­ç«ç„¼ãé³¥ é´¨å°½", lat: 34.7005, lng: 135.5015, category: "osaka", type: ["izakaya"], address: "æ¢…ç”°", hours: "17:00-23:00", rating: 4.5, reviewCount: 80 },
            { id: 81, name: "é…’å ´ ãƒ©ã‚¸ã‚«ãƒ«(å±…é…’å±‹+èŠ³é†‡è±š+ç„¦ç‡’é›è›‹+igä»‹ç´¹å¤§æ¨)", displayName: "é…’å ´ ãƒ©ã‚¸ã‚«ãƒ«", lat: 34.7055, lng: 135.5105, category: "osaka", type: ["izakaya"], address: "å¤©æ»¿", hours: "15:00-23:00", rating: 4.4, reviewCount: 150 },
            { id: 82, name: "ä¸­åœ‹èœ å¿ƒé¦™(è¥¿å¤©æ»¿+ç±³å…¶æ—+éµé‹éº»å©†è±†è…+åˆé–“å¥—é¤)", displayName: "ä¸­åœ‹èœ å¿ƒé¦™", lat: 34.6975, lng: 135.5065, category: "osaka", type: ["other", "lunch"], address: "è¥¿å¤©æ»¿", hours: "11:30-14:00, 18:00-22:00", rating: 4.3, reviewCount: 220 },
            { id: 83, name: "ç¾½æŸ´å®¶ beef(éƒ½å³¶+ç‡’è‚‰+å¯èƒ½æ¯”å¤§é˜ªå¸‚ä¸­å¿ƒä¾¿å®œ)", displayName: "ç¾½æŸ´å®¶ beef", lat: 34.7215, lng: 135.5255, category: "osaka", type: ["yakiniku"], address: "éƒ½å³¶", hours: "17:00-23:00", rating: 4.5, reviewCount: 60 }
        ];

        // --- Helper: Shop Status (Open, Closing Soon, Closed, Unknown) ---
        const getShopStatus = (hoursStr) => {
            if (!hoursStr) return 'unknown';
            if (hoursStr.includes("24å°æ™‚")) return 'open';

            const now = new Date();
            const currentDay = now.getDay();
            const currentHour = now.getHours();
            const currentMin = now.getMinutes();
            const currentTime = currentHour * 60 + currentMin;

            const dayMap = { 'æ—¥': 0, 'ä¸€': 1, 'äºŒ': 2, 'ä¸‰': 3, 'å››': 4, 'äº”': 5, 'å…­': 6 };
            const closedMatch = hoursStr.match(/é€±([æ—¥ä¸€äºŒä¸‰å››äº”å…­])å…¬ä¼‘/);
            if (closedMatch && dayMap[closedMatch[1]] === currentDay) return 'closed';

            const ranges = hoursStr.match(/(\d{1,2}:\d{2})-(\d{1,2}:\d{2})/g);
            if (!ranges) return 'unknown';

            let isOpen = false;
            let isClosingSoon = false;

            for (let range of ranges) {
                let [start, end] = range.split('-');
                let [sH, sM] = start.split(':').map(Number);
                let [eH, eM] = end.split(':').map(Number);
                
                let startTime = sH * 60 + sM;
                let endTime = eH * 60 + eM;
                
                if (endTime < startTime) endTime += 24 * 60;
                let tempCurrentTime = currentTime;
                if (endTime > 24 * 60 && currentTime < 12 * 60) tempCurrentTime += 24 * 60;

                if (tempCurrentTime >= startTime && tempCurrentTime < endTime) {
                    isOpen = true;
                    if (endTime - tempCurrentTime <= 60) {
                        isClosingSoon = true;
                    }
                }
            }

            if (isOpen) {
                return isClosingSoon ? 'closing_soon' : 'open';
            }
            return 'closed';
        };

        // --- Helper: Copy Text (Legacy Fallback) ---
        const copyToClipboard = (text, successMessage) => {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.position = "fixed";
            textArea.style.left = "-9999px";
            textArea.style.top = "0";
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    if (successMessage) alert(successMessage);
                } else {
                    console.error('Fallback copy failed.');
                }
            } catch (err) {
                console.error('Fallback copy failed', err);
            }
            document.body.removeChild(textArea);
        };

        const copyShopName = (fullName) => {
            const name = fullName.split(/[\(ï¼ˆ]/)[0].trim();
            copyToClipboard(name, `å·²è¤‡è£½åº—åï¼š${name}`);
        };
        window.copyShopName = copyShopName;

        // --- Helper: Distance Calculation ---
        const getDistance = (lat1, lon1, lat2, lon2) => {
            const R = 6371; 
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * Math.sin(dLon/2) * Math.sin(dLon/2); 
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
            return R * c;
        };

        // --- Helper: Get labels from IDs ---
        const getFoodTypeLabels = (typeIds) => {
            const ids = Array.isArray(typeIds) ? typeIds : [typeIds || 'other'];
            return ids.map(id => {
                const found = FOOD_TYPES.find(t => t.id === id);
                return found ? found.label : 'å…¶å®ƒ';
            });
        };

        // --- Component: Digital Clock ---
        function DigitalClock() {
            const [time, setTime] = useState(new Date());
            useEffect(() => {
                const timer = setInterval(() => setTime(new Date()), 1000);
                return () => clearInterval(timer);
            }, []);
            return (
                <div className="flex flex-col items-center mb-4">
                    <div className="text-4xl font-mono font-bold text-gray-700 tracking-wider">
                        {time.toLocaleTimeString('en-US', { hour12: false, hour: '2-digit', minute: '2-digit' })}
                    </div>
                    <div className="text-xs text-gray-400 mt-1">
                        {time.toLocaleDateString('zh-TW', { month: 'long', day: 'numeric', weekday: 'long' })}
                    </div>
                </div>
            );
        }

        // --- Component: Transition Overlay ---
        function TransitionOverlay({ isAnimating, color, origin, onCovered, onFinished, targetCategory }) {
            const [style, setStyle] = useState({});

            useEffect(() => {
                if (isAnimating && origin) {
                    // 1. Initial State (small circle at button center)
                    setStyle({
                        top: origin.y,
                        left: origin.x,
                        width: '0px',
                        height: '0px',
                        borderRadius: '50%',
                        transform: 'translate(-50%, -50%)', 
                        backgroundColor: 'transparent', 
                        boxShadow: `0 0 0 20px ${color}`, 
                        zIndex: 9999,
                        pointerEvents: 'none',
                        transition: 'none' 
                    });

                    // 2. Expand Animation (Fill Screen)
                    requestAnimationFrame(() => {
                        requestAnimationFrame(() => {
                            setStyle(prev => ({
                                ...prev,
                                // Animate box-shadow to cover the screen
                                // 300vmax is large enough to cover typical screens from any point
                                boxShadow: `0 0 0 300vmax ${color}`, 
                                transition: 'box-shadow 0.5s ease-in' 
                            }));
                        });
                    });

                    // 3. Trigger View Switch (When fully covered)
                    const coverTimer = setTimeout(() => {
                        onCovered(); 

                        // 4. Disappear (Fade out)
                        setTimeout(() => {
                            setStyle(prev => ({
                                ...prev,
                                opacity: 0,
                                transition: 'opacity 0.5s ease-out'
                            }));
                        }, 100);

                    }, 500); 

                    // 5. Cleanup
                    const finishTimer = setTimeout(() => {
                        onFinished();
                    }, 1100);

                    return () => {
                        clearTimeout(coverTimer);
                        clearTimeout(finishTimer);
                    };
                } else {
                     setStyle({});
                }
            }, [isAnimating, origin, onCovered, onFinished, color]);

            if (!isAnimating) return null;

            return (
                <div 
                    className="transition-layer"
                    style={style}
                />
            );
        }

        // --- Component: MapView ---
        function MapView({ center, shops }) {
            const mapContainerRef = useRef(null);
            const mapInstanceRef = useRef(null);
            const markersRef = useRef([]);

            // Icons
            const createIcon = (colorUrl) => new L.Icon({
                iconUrl: colorUrl,
                shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
                iconSize: [25, 41],
                iconAnchor: [12, 41],
                popupAnchor: [1, -34],
                shadowSize: [41, 41]
            });

            const blackIcon = createIcon('https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-black.png');
            const redIcon = createIcon('https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-red.png');
            const blueIcon = createIcon('https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-blue.png');
            const yellowIcon = createIcon('https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-yellow.png'); 

            useEffect(() => {
                if (!mapContainerRef.current) return;
                
                delete L.Icon.Default.prototype._getIconUrl;
                L.Icon.Default.mergeOptions({
                    iconRetinaUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png',
                    iconUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png',
                    shadowUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png',
                });

                const map = L.map(mapContainerRef.current).setView([center.lat, center.lng], 13);
                
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; OpenStreetMap contributors'
                }).addTo(map);

                // ä¸­å¿ƒé»ï¼šé»‘è‰²
                L.marker([center.lat, center.lng], { icon: blackIcon })
                    .bindPopup(`<b>${center.name}</b> (ä¸­å¿ƒ)`)
                    .addTo(map);

                mapInstanceRef.current = map;

                return () => {
                    map.remove();
                    mapInstanceRef.current = null;
                };
            }, []); 

            useEffect(() => {
                if (!mapInstanceRef.current) return;
                const map = mapInstanceRef.current;

                map.eachLayer((layer) => {
                    // Update center marker (black)
                    if (layer instanceof L.Marker && layer.getIcon().options.iconUrl.includes('black')) {
                         layer.setLatLng([center.lat, center.lng])
                              .setPopupContent(`<b>${center.name}</b> (ä¸­å¿ƒ)`)
                              .openPopup();
                    }
                });

                markersRef.current.forEach(m => m.remove());
                markersRef.current = [];

                const points = [[center.lat, center.lng]];

                shops.forEach(shop => {
                    points.push([shop.lat, shop.lng]);

                    const labels = getFoodTypeLabels(shop.type);
                    const tagsHtml = labels.map(label => 
                        `<span style="font-size: 11px; background-color: #f3f4f6; padding: 2px 6px; border-radius: 4px; border: 1px solid #e5e7eb; color: #4b5563; display: inline-block; margin-right: 4px; margin-bottom: 2px;">${label}</span>`
                    ).join('');

                    // Determine icon color
                    const status = getShopStatus(shop.hours);
                    let markerIcon = blueIcon; // Default closed
                    let statusHtml = '';

                    if (status === 'unknown') {
                        markerIcon = yellowIcon;
                        statusHtml = '<span style="color: #ca8a04; font-weight: bold;">â— ç‡Ÿæ¥­æ™‚é–“æœªçŸ¥</span>';
                    } else if (status === 'closing_soon') {
                        markerIcon = yellowIcon;
                        statusHtml = '<span style="color: #ca8a04; font-weight: bold;">â— å³å°‡æ‰“çƒŠ</span>';
                    } else if (status === 'open') {
                        markerIcon = redIcon;
                        statusHtml = '<span style="color: #16a34a; font-weight: bold;">â— ç‡Ÿæ¥­ä¸­</span>';
                    } else {
                        markerIcon = blueIcon;
                        statusHtml = '<span style="color: #dc2626; font-weight: bold;">â— ä¼‘æ¯ä¸­/å·²æ‰“çƒŠ</span>';
                    }

                    const popupContent = `
                        <div class="p-1">
                            <div style="display: flex; justify-content: space-between; align-items: start;">
                                <h3 class="font-bold text-base mb-1" style="margin-right: 20px;">${shop.name}</h3>
                                <button onclick="window.copyShopName('${shop.name.replace(/'/g, "\\'")}')" style="background:none; border:none; cursor:pointer; color: #6b7280; padding: 2px;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                                </button>
                            </div>
                            <div class="mb-2" style="display: flex; flex-wrap: wrap;">
                                ${tagsHtml}
                            </div>
                            <p class="text-xs mb-1">${statusHtml}</p>
                            ${shop.hours ? `<p class="text-xs text-gray-500 mb-2">ğŸ•˜ ${shop.hours}</p>` : ''}
                            <p class="text-xs text-gray-600 mb-2">â­ ${shop.rating ? shop.rating.toFixed(1) : 'N/A'} (${shop.reviewCount || 0}å‰‡è©•è«–)</p>
                            <a href="https://maps.google.com/?q=${shop.lat},${shop.lng}" 
                               target="_blank" 
                               style="color: #2563eb; text-decoration: none; font-size: 12px; display: flex; align-items: center; gap: 4px;">
                               â¤ é–‹å•Ÿ Google Maps å°èˆª
                            </a>
                        </div>
                    `;

                    const marker = L.marker([shop.lat, shop.lng], { icon: markerIcon })
                        .bindPopup(popupContent)
                        .addTo(map);
                    markersRef.current.push(marker);
                });

                if (shops.length > 0) {
                    const bounds = L.latLngBounds(points);
                    map.fitBounds(bounds, {
                        padding: [50, 50],
                        maxZoom: 16,
                        animate: true,
                        duration: 1.0
                    });
                } else {
                    map.flyTo([center.lat, center.lng], 13, { duration: 1.0 });
                }

            }, [center, shops]);

            return <div ref={mapContainerRef} className="h-full w-full"></div>;
        }

        // --- Main App Component ---
        function App() {
            const [userShops, setUserShops] = useState(() => {
                const saved = localStorage.getItem('kansai_shops');
                if (saved) {
                    const parsed = JSON.parse(saved);
                    return parsed.filter(s => s.id > 10000); 
                }
                return []; 
            });

            useEffect(() => {
                localStorage.setItem('kansai_shops', JSON.stringify(userShops));
            }, [userShops]);

            const [inputName, setInputName] = useState('');
            const [inputType, setInputType] = useState(['other']); 
            const [activeTab, setActiveTab] = useState('add');
            const [listTab, setListTab] = useState('my'); 
            const [mapCategory, setMapCategory] = useState('kyoto');
            const [osakaSubLocation, setOsakaSubLocation] = useState('umeda');
            const [kyotoSubLocation, setKyotoSubLocation] = useState('kyoto_station');
            const [mapFilterType, setMapFilterType] = useState('all'); 
            const [mapFilterDistance, setMapFilterDistance] = useState('all');
            const [mapFilterSpecial, setMapFilterSpecial] = useState([]);
            // ä¿®æ”¹ï¼šè©•åˆ†ç¯©é¸ç‹€æ…‹æ”¹ç‚ºå­—ä¸² 'all' | 'over4' | 'top'
            const [mapFilterRating, setMapFilterRating] = useState('all');
            const [isDetailMenuOpen, setIsDetailMenuOpen] = useState(true);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);
            const [showList, setShowList] = useState(true);
            const [currentPage, setCurrentPage] = useState(1);
            const ITEMS_PER_PAGE = 5;

            // Animation States (Adding ID to force re-render)
            const [animState, setAnimState] = useState({ isAnimating: false, color: '', origin: null, targetCategory: '', id: 0 });

            // Determine if an "Other Area" sublocation is selected
            const isOtherAreaSelected = (mapCategory === 'kyoto' && kyotoSubLocation === 'kyoto_other') || 
                                        (mapCategory === 'osaka' && osakaSubLocation === 'osaka_other');

            const currentCenter = useMemo(() => {
                if (mapCategory === 'kyoto') {
                    return KYOTO_SUBLOCATIONS[kyotoSubLocation] || LOCATIONS.kyoto;
                } else {
                    return OSAKA_SUBLOCATIONS[osakaSubLocation] || LOCATIONS.osaka;
                }
            }, [mapCategory, osakaSubLocation, kyotoSubLocation]);

            // Effect: Reset distance filter if "Other Area" is selected
            useEffect(() => {
                if (isOtherAreaSelected) {
                    setMapFilterDistance('all');
                }
            }, [isOtherAreaSelected]);

            const handleInputTypeClick = (id) => {
                 if (id === 'other') {
                    setInputType(['other']);
                } else {
                    let newTypes;
                    if (inputType.includes('other') && inputType.length === 1) {
                        newTypes = [id];
                    } else {
                        if (inputType.includes(id)) {
                            newTypes = inputType.filter(t => t !== id);
                        } else {
                            newTypes = [...inputType, id];
                        }
                    }
                    if (newTypes.length === 0) {
                        newTypes = ['other'];
                    }
                    setInputType(newTypes);
                }
            };

            const handleAddShop = async () => {
                 if (!inputName.trim()) return;
                setLoading(true);
                setError(null);
                const searchName = inputName.split(/[\(ï¼ˆ]/)[0].trim();
                try {
                    const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(searchName + ' æ—¥æœ¬')}&limit=1`);
                    const data = await response.json();
                    if (data && data.length > 0) {
                        const place = data[0];
                        const lat = parseFloat(place.lat);
                        const lng = parseFloat(place.lon);
                        const distToKyoto = getDistance(lat, lng, LOCATIONS.kyoto.lat, LOCATIONS.kyoto.lng);
                        const distToOsaka = getDistance(lat, lng, LOCATIONS.osaka.lat, LOCATIONS.osaka.lng);
                        const category = distToKyoto < distToOsaka ? 'kyoto' : 'osaka';
                        const newShop = {
                            id: Date.now(),
                            name: inputName, 
                            displayName: place.display_name.split(',')[0],
                            lat,
                            lng,
                            category,
                            type: inputType, 
                            address: place.display_name,
                            hours: "" 
                        };
                        setUserShops([newShop, ...userShops]);
                        setInputName('');
                        setListTab('my');
                        setShowList(true);
                        setCurrentPage(1);
                    } else {
                        setError('æ‰¾ä¸åˆ°è©²åº—èˆ–ï¼Œè«‹å˜—è©¦æ›´ç²¾ç¢ºçš„åç¨±ï¼Œæˆ–ç¢ºèªæ‹¬è™Ÿä½ç½®æ˜¯å¦æ­£ç¢ºã€‚');
                    }
                } catch (err) {
                    setError('æœå°‹æ™‚ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·šã€‚');
                } finally {
                    setLoading(false);
                }
            };

            const handleDelete = (id) => {
                setUserShops(userShops.filter(shop => shop.id !== id));
            };

            const handleExport = () => {
                const dataStr = JSON.stringify(userShops);
                copyToClipboard(dataStr, "âœ… å€‹äººè³‡æ–™å·²è¤‡è£½ï¼");
            };

            const allShopsForMap = useMemo(() => {
                return [...userShops, ...SYSTEM_SHOPS];
            }, [userShops]);

            const checkIsAllYouCanEat = (shop) => {
                const text = (shop.name || '') + (shop.displayName || '');
                const keywords = ['åƒåˆ°é£½', 'é£Ÿã¹æ”¾é¡Œ'];
                return keywords.some(k => text.includes(k));
            };

            const checkIsWagyu = (shop) => {
                const text = (shop.name || '') + (shop.displayName || '');
                const keywords = ['å’Œç‰›', 'Wagyu', 'ç¥æˆ¶ç‰›', 'ç¥æˆ¸ç‰›', 'ä½†é¦¬ç‰›', 'è¿‘æ±Ÿç‰›', 'å®®å´ç‰›', 'ä»™å°ç‰›', 'é»’æ¯›', 'é»‘æ¯›', 'ç‰›èˆŒ'];
                return keywords.some(k => text.includes(k));
            };

            const checkIsBeefTongue = (shop) => {
                const text = (shop.name || '') + (shop.displayName || '');
                const keywords = ['ç‰›èˆŒ', 'ç‰›ã‚¿ãƒ³', 'ã‚¿ãƒ³'];
                return keywords.some(k => text.includes(k));
            };
            
            const checkIsHamburger = (shop) => {
                if (shop.type && shop.type.includes('hamburger')) return true;
                const text = (shop.name || '') + (shop.displayName || '');
                const keywords = ['æ¼¢å ¡æ’', 'ãƒãƒ³ãƒãƒ¼ã‚°', 'Hamburg'];
                return keywords.some(k => text.includes(k));
            };
            
            const checkIsIzakaya = (shop) => {
                if (shop.type && shop.type.includes('izakaya')) return true;
                const text = (shop.name || '') + (shop.displayName || '');
                const keywords = ['å±…é…’å±‹', 'ä¸²ç‡’', 'ç„¼ãé³¥', 'ãŠã§ã‚“', 'ä¸²', 'é…’å ´', 'Izakaya', 'Yakitori'];
                return keywords.some(k => text.includes(k));
            };
            
            const checkIsLunch = (shop) => {
                const text = (shop.name || '') + (shop.displayName || '');
                const keywords = ['åˆé–“', 'lunch', 'ãƒ©ãƒ³ãƒ', 'åˆé¤'];
                return keywords.some(k => text.toLowerCase().includes(k));
            }
            
            const checkIsKissaten = (shop) => {
                const text = (shop.name || '') + (shop.displayName || '');
                const keywords = ['å–«èŒ¶', 'afternoon tea', 'ç”œé»', 'dessert', 'tea'];
                return keywords.some(k => text.toLowerCase().includes(k));
            };

            const filteredShops = useMemo(() => {
                return allShopsForMap.filter(shop => {
                    const matchLocation = shop.category === mapCategory;
                    
                    const shopTypes = Array.isArray(shop.type) ? shop.type : [shop.type || 'other'];
                    const matchType = mapFilterType === 'all' || shopTypes.includes(mapFilterType);
                    
                    // Filter Logic: "Other Areas" (è·é›¢ä¸»è¦å­ä¸­å¿ƒ > 2km)
                    let matchSubLocation = true;
                    if (mapCategory === 'kyoto' && kyotoSubLocation === 'kyoto_other') {
                        const distKyoto = getDistance(shop.lat, shop.lng, KYOTO_SUBLOCATIONS.kyoto_station.lat, KYOTO_SUBLOCATIONS.kyoto_station.lng);
                        const distUji = getDistance(shop.lat, shop.lng, KYOTO_SUBLOCATIONS.uji_station.lat, KYOTO_SUBLOCATIONS.uji_station.lng);
                        if (distKyoto <= 2 || distUji <= 2) matchSubLocation = false;
                    } else if (mapCategory === 'osaka' && osakaSubLocation === 'osaka_other') {
                        const distUmeda = getDistance(shop.lat, shop.lng, OSAKA_SUBLOCATIONS.umeda.lat, OSAKA_SUBLOCATIONS.umeda.lng);
                        const distShinsaibashi = getDistance(shop.lat, shop.lng, OSAKA_SUBLOCATIONS.shinsaibashi.lat, OSAKA_SUBLOCATIONS.shinsaibashi.lng);
                        const distTennoji = getDistance(shop.lat, shop.lng, OSAKA_SUBLOCATIONS.tennoji.lat, OSAKA_SUBLOCATIONS.tennoji.lng);
                        
                        if (distUmeda <= 2 || distShinsaibashi <= 2 || distTennoji <= 2) matchSubLocation = false;
                    } else {
                        // Standard sub-location filter: Must be within 2km of selected hub
                        const isSpecificHub = (mapCategory === 'kyoto' && kyotoSubLocation !== 'kyoto_other') || 
                                              (mapCategory === 'osaka' && osakaSubLocation !== 'osaka_other');
                        
                        if (isSpecificHub) {
                            const distToHub = getDistance(shop.lat, shop.lng, currentCenter.lat, currentCenter.lng);
                            if (distToHub > 2) matchSubLocation = false;
                        }
                    }

                    let matchDistance = true;
                    if (mapFilterDistance !== 'all') {
                         const dist = getDistance(shop.lat, shop.lng, currentCenter.lat, currentCenter.lng);
                         if (mapFilterDistance === 'near') {
                             matchDistance = dist <= 1;
                         } else if (mapFilterDistance === 'far') {
                             matchDistance = dist > 1 && dist <= 2;
                         }
                    }

                    let matchSpecial = true;
                    if (mapFilterSpecial.length > 0) {
                        const isWagyu = checkIsWagyu(shop);
                        const isBeefTongue = checkIsBeefTongue(shop);
                        const isAllYouCanEat = checkIsAllYouCanEat(shop);
                        const isHamburger = checkIsHamburger(shop);
                        const isIzakaya = checkIsIzakaya(shop);
                        const isLunch = checkIsLunch(shop);
                        const isKissaten = checkIsKissaten(shop);
                        
                        const selectWagyu = mapFilterSpecial.includes('wagyu');
                        const selectBeefTongue = mapFilterSpecial.includes('beef_tongue');
                        const selectAllYouCanEat = mapFilterSpecial.includes('all_you_can_eat');
                        const selectHamburger = mapFilterSpecial.includes('hamburger');
                        const selectIzakaya = mapFilterSpecial.includes('izakaya');
                        const selectLunch = mapFilterSpecial.includes('lunch');
                        const selectKissaten = mapFilterSpecial.includes('kissaten');

                        if (selectWagyu && !isWagyu) matchSpecial = false;
                        if (selectBeefTongue && !isBeefTongue) matchSpecial = false;
                        if (selectAllYouCanEat && !isAllYouCanEat) matchSpecial = false;
                        if (selectHamburger && !isHamburger) matchSpecial = false;
                        if (selectIzakaya && !isIzakaya) matchSpecial = false;
                        if (selectLunch && !isLunch) matchSpecial = false;
                        if (selectKissaten && !isKissaten) matchSpecial = false;
                    }
                    
                    // Rating Filter (Logic Updated)
                    if (mapFilterRating === 'over4') {
                        if ((shop.rating || 0) < 4) return false;
                    } else if (mapFilterRating === 'top') {
                        if ((shop.rating || 0) < 4.5) return false;
                    }

                    return matchLocation && matchSubLocation && matchType && matchDistance && matchSpecial;
                });
            }, [allShopsForMap, mapCategory, mapFilterType, mapFilterDistance, currentCenter, mapFilterSpecial, kyotoSubLocation, osakaSubLocation, mapFilterRating]);

            const handleSpecialFilterClick = (id) => {
                let newSelection;
                if (mapFilterSpecial.includes(id)) {
                    newSelection = mapFilterSpecial.filter(item => item !== id);
                } else {
                    newSelection = [...mapFilterSpecial, id];
                }
                setMapFilterSpecial(newSelection);
            };

            const handleCityClick = (category, event) => {
                const rect = event.currentTarget.getBoundingClientRect();
                const center = {
                    x: rect.left + rect.width / 2,
                    y: rect.top + rect.height / 2
                };
                
                const color = category === 'kyoto' ? '#e0e7ff' : '#ffe4e6';

                setAnimState({
                    isAnimating: true,
                    color: color,
                    origin: center,
                    targetCategory: category,
                    id: Date.now() // Unique ID to force re-mount
                });
            };

            const handleCovered = useCallback(() => {
                setMapCategory(animState.targetCategory);
                setActiveTab('map');
            }, [animState.targetCategory]);

            const handleFinished = useCallback(() => {
                setAnimState(prev => ({ ...prev, isAnimating: false }));
            }, []);

            const goToMap = (category) => {
                setMapCategory(category);
                setActiveTab('map');
            };

            const shopsToList = listTab === 'my' ? userShops : SYSTEM_SHOPS;
            const displayList = listTab === 'my' ? [...shopsToList] : [...shopsToList]; 
            const totalPages = Math.ceil(displayList.length / ITEMS_PER_PAGE) || 1;
            
            useEffect(() => {
                setCurrentPage(1);
            }, [listTab]);

            const currentShops = displayList.slice((currentPage - 1) * ITEMS_PER_PAGE, currentPage * ITEMS_PER_PAGE);

            return (
                <div className="flex flex-col h-screen">
                    {/* Render Overlay only when animating, with unique key to force reset */}
                    {animState.isAnimating && (
                        <TransitionOverlay 
                            key={animState.id}
                            isAnimating={animState.isAnimating}
                            color={animState.color}
                            origin={animState.origin}
                            onCovered={handleCovered}
                            onFinished={handleFinished}
                            targetCategory={animState.targetCategory}
                        />
                    )}

                    {/* Header... */}
                    <header className="bg-white shadow-sm p-4 pt-safe-top z-10 sticky top-0 relative">
                        {activeTab === 'map' && (
                            <button 
                                onClick={() => setActiveTab('add')}
                                className="absolute left-2 top-1/2 -translate-y-1/2 p-2 text-gray-600 hover:text-blue-600 active:scale-90 transition-transform"
                                aria-label="è¿”å›"
                            >
                                <IconArrowLeft />
                            </button>
                        )}
                        <h1 className="text-xl font-bold text-center text-gray-800 flex items-center justify-center gap-2">
                            <span className="text-blue-600"><IconMapPin className="w-6 h-6"/></span>
                            ç¾é£Ÿç‰¹è¼¯åœ°åœ– äº¬é˜ªver.
                        </h1>
                    </header>

                    <main className="flex-1 overflow-hidden relative">
                        {activeTab === 'add' && (
                            <div className="h-full overflow-y-auto p-4 max-w-md mx-auto">
                                {/* Input Card... */}
                                <div className="bg-white p-4 rounded-xl shadow-sm mb-6">
                                    <DigitalClock />
                                    <div className="mb-3">
                                        <label className="block text-sm font-medium text-gray-700 mb-2">é¸æ“‡ç¾é£Ÿé¡åˆ¥ (å¯è¤‡é¸)</label>
                                        <div className="flex flex-wrap gap-2">
                                            {FOOD_TYPES.map(t => (
                                                <button
                                                    key={t.id}
                                                    onClick={() => handleInputTypeClick(t.id)}
                                                    className={`px-3 py-1.5 rounded-full text-xs font-medium border transition-colors ${
                                                        inputType.includes(t.id)
                                                            ? 'bg-black text-white border-black'
                                                            : 'bg-gray-50 text-gray-600 border-gray-200 hover:bg-gray-100'
                                                    }`}
                                                >
                                                    {t.label}
                                                </button>
                                            ))}
                                        </div>
                                    </div>

                                    <label className="block text-sm font-medium text-gray-700 mb-2">è¼¸å…¥åº—é‹ªåç¨±</label>
                                    
                                    <div className="flex gap-2">
                                        <input
                                            type="text"
                                            value={inputName}
                                            onChange={(e) => setInputName(e.target.value)}
                                            placeholder="ä¾‹ï¼šéºµå±‹å£¹ã®ç©´ ICHI(å»ºä¸­æ—¥ç ”72ç¬¬äºŒç¤¾è¾¦)"
                                            className="flex-1 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none text-sm"
                                            onKeyDown={(e) => e.key === 'Enter' && handleAddShop()}
                                        />
                                        <button
                                            onClick={handleAddShop}
                                            disabled={loading}
                                            className="bg-blue-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-blue-700 disabled:bg-gray-400 transition-colors flex items-center justify-center min-w-[50px]"
                                        >
                                            {loading ? (
                                                <div className="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                                            ) : (
                                                <IconSearch />
                                            )}
                                        </button>
                                    </div>
                                    {error && <p className="text-red-500 text-sm mt-2">{error}</p>}
                                </div>

                                {/* Animated Buttons Grid (Updated Layout) */}
                                <div className="grid grid-cols-2 gap-4 mb-6">
                                    <button 
                                        onClick={(e) => handleCityClick('kyoto', e)}
                                        className="aspect-square bg-indigo-50 p-2 rounded-full rounded-br-none transform rotate-45 border-2 border-indigo-100 text-center hover:bg-indigo-100 transition-all btn-active group shadow-md w-32 mx-auto flex flex-col justify-center items-center overflow-hidden relative"
                                    >
                                        <div className="transform -rotate-45 flex flex-col items-center justify-center w-full h-full relative z-10">
                                            <span className="text-lg font-bold text-indigo-400 uppercase tracking-wider block mb-2">Kyoto</span>
                                            <p className="text-3xl font-black text-indigo-600 mb-1">
                                                {allShopsForMap.filter(s => s.category === 'kyoto').length}
                                            </p>
                                            <h3 className="text-indigo-800 font-bold text-xs mt-2">äº¬éƒ½</h3>
                                        </div>
                                    </button>
                                    
                                    <button 
                                        onClick={(e) => handleCityClick('osaka', e)}
                                        className="aspect-square bg-rose-50 p-2 rounded-full rounded-br-none transform rotate-45 border-2 border-rose-100 text-center hover:bg-rose-100 transition-all btn-active group shadow-md w-32 mx-auto flex flex-col justify-center items-center overflow-hidden relative"
                                    >
                                        <div className="transform -rotate-45 flex flex-col items-center justify-center w-full h-full relative z-10">
                                            <span className="text-lg font-bold text-rose-400 uppercase tracking-wider block mb-2">Osaka</span>
                                            <p className="text-3xl font-black text-rose-600 mb-1">
                                                {allShopsForMap.filter(s => s.category === 'osaka').length}
                                            </p>
                                            <h3 className="text-rose-800 font-bold text-xs mt-2">å¤§é˜ª</h3>
                                        </div>
                                    </button>
                                </div>

                                {/* List Tabs - Moved down */}
                                <div className="flex items-center justify-between mb-3 border-b border-gray-200 mt-10">
                                    <div className="flex gap-4">
                                        <button
                                            onClick={() => setListTab('my')}
                                            className={`pb-2 text-sm font-bold uppercase tracking-wider transition-colors border-b-2 ${
                                                listTab === 'my' 
                                                    ? 'text-blue-600 border-blue-600' 
                                                    : 'text-gray-400 border-transparent hover:text-gray-600'
                                            }`}
                                        >
                                            æˆ‘çš„åº—é‹ª
                                        </button>
                                        <button
                                            onClick={() => setListTab('system')}
                                            className={`pb-2 text-sm font-bold uppercase tracking-wider transition-colors border-b-2 ${
                                                listTab === 'system' 
                                                    ? 'text-purple-600 border-purple-600' 
                                                    : 'text-gray-400 border-transparent hover:text-gray-600'
                                            }`}
                                        >
                                            ç³»çµ±æ¨è–¦
                                        </button>
                                    </div>
                                    <button
                                        onClick={() => setShowList(!showList)}
                                        className="text-gray-400 hover:text-gray-600 p-1 rounded-full hover:bg-gray-100 transition-colors mb-1"
                                        aria-label={showList ? "æ”¶èµ·åˆ—è¡¨" : "å±•é–‹åˆ—è¡¨"}
                                    >
                                        {showList ? <IconChevronUp /> : <IconChevronDown />}
                                    </button>
                                </div>

                                {/* Shop List Content ... */}
                                {showList && (
                                    <div className="space-y-3 pb-6">
                                        {currentShops.length === 0 ? (
                                            <div className="text-center py-10 text-gray-400">
                                                <p>{listTab === 'my' ? 'é‚„æ²’æœ‰æ”¶è—ä»»ä½•åº—èˆ–' : 'æš«ç„¡æ¨è–¦åº—é‹ª'}</p>
                                            </div>
                                        ) : (
                                            currentShops.map(shop => {
                                                const labels = getFoodTypeLabels(shop.type);
                                                const isWagyu = checkIsWagyu(shop);
                                                return (
                                                    <div key={shop.id} className="bg-white p-4 rounded-lg shadow-sm border border-gray-100 flex justify-between items-center group">
                                                        <div className="flex-1 min-w-0 pr-2">
                                                            <div className="flex justify-between items-start">
                                                                <h4 className="font-bold text-gray-800 break-words whitespace-pre-wrap text-sm leading-snug flex items-center gap-2">
                                                                    {listTab === 'system' && <IconStar className="text-yellow-400 w-3.5 h-3.5 flex-shrink-0"/>}
                                                                    {shop.name}
                                                                </h4>
                                                                <button 
                                                                    onClick={() => copyShopName(shop.name)}
                                                                    className="text-gray-400 hover:text-gray-600 p-1 rounded hover:bg-gray-100"
                                                                    title="è¤‡è£½åº—å"
                                                                >
                                                                    <IconCopy />
                                                                </button>
                                                            </div>
                                                            <div className="flex items-center gap-2 mt-1 flex-wrap">
                                                                <span className={`text-xs px-2 py-0.5 rounded-full text-white shrink-0 ${shop.category === 'kyoto' ? 'bg-indigo-500' : 'bg-rose-500'}`}>
                                                                    {shop.category === 'kyoto' ? 'äº¬éƒ½' : 'å¤§é˜ª'}
                                                                </span>
                                                                {labels.map((label, idx) => (
                                                                    <span key={idx} className="text-xs px-2 py-0.5 rounded-full bg-gray-100 text-gray-600 border border-gray-200 shrink-0">
                                                                        {label}
                                                                    </span>
                                                                ))}
                                                                {isWagyu && (
                                                                    <span className="text-xs px-2 py-0.5 rounded-full bg-orange-100 text-orange-800 border border-orange-200 shrink-0">
                                                                        å’Œç‰›
                                                                    </span>
                                                                )}
                                                            </div>
                                                            <p className="text-xs text-gray-500 truncate mt-1">{shop.address || 'ç„¡åœ°å€è³‡è¨Š'}</p>
                                                            {shop.hours && (
                                                                <p className="text-xs text-gray-400 mt-0.5 flex items-center gap-1">
                                                                    <IconClock className="w-3 h-3"/>
                                                                    {shop.hours}
                                                                </p>
                                                            )}
                                                        </div>
                                                        
                                                        {listTab === 'my' && (
                                                            <button 
                                                                onClick={() => handleDelete(shop.id)}
                                                                className="text-gray-400 hover:text-red-500 p-2 shrink-0 ml-2"
                                                            >
                                                                <IconTrash />
                                                            </button>
                                                        )}
                                                    </div>
                                                );
                                            })
                                        )}
                                        {/* Pagination ... */}
                                        {displayList.length > ITEMS_PER_PAGE && (
                                            <div className="flex justify-center items-center gap-4 pt-2">
                                                <button 
                                                    disabled={currentPage === 1}
                                                    onClick={() => setCurrentPage(p => Math.max(1, p - 1))}
                                                    className="p-1 rounded-full hover:bg-gray-100 disabled:opacity-30 transition-colors text-gray-600"
                                                >
                                                    <IconChevronLeft />
                                                </button>
                                                <span className="text-xs text-gray-500 font-medium">
                                                    {currentPage} / {totalPages}
                                                </span>
                                                <button 
                                                    disabled={currentPage === totalPages}
                                                    onClick={() => setCurrentPage(p => Math.min(totalPages, p + 1))}
                                                    className="p-1 rounded-full hover:bg-gray-100 disabled:opacity-30 transition-colors text-gray-600"
                                                >
                                                    <IconChevronRight />
                                                </button>
                                            </div>
                                        )}
                                    </div>
                                )}

                                {/* Export (My Shops only) */}
                                {listTab === 'my' && (
                                    <div className="pt-6 pb-20 border-t border-gray-200 text-center">
                                        <button 
                                            onClick={handleExport}
                                            className="inline-flex items-center gap-2 text-gray-500 hover:text-gray-700 bg-gray-100 hover:bg-gray-200 px-4 py-2 rounded-full text-sm font-medium transition-colors"
                                        >
                                            <IconDownload />
                                            è¼¸å‡ºå€‹äººç´€éŒ„
                                        </button>
                                        <p className="text-xs text-gray-400 mt-2">
                                            é»æ“Šè¤‡è£½è³‡æ–™ï¼Œå¯ç”¨æ–¼å‚™ä»½æˆ–è²¼å›ç¨‹å¼ç¢¼ä¸­
                                        </p>
                                    </div>
                                )}
                                {listTab === 'system' && (
                                    <div className="pb-20 text-center text-xs text-gray-400 pt-4">
                                        ç³»çµ±æ¨è–¦åº—é‹ªç„¡æ³•åˆªé™¤æˆ–ä¿®æ”¹
                                    </div>
                                )}
                            </div>
                        )}

                        {activeTab === 'map' && (
                            <div className="h-full flex flex-col">
                                {/* Map Controls... */}
                                <div className="flex p-2 gap-2 bg-white shadow-sm z-20 shrink-0">
                                    <button
                                        onClick={() => setMapCategory('kyoto')}
                                        className={`flex-1 py-3 rounded-lg font-bold transition-all ${
                                            mapCategory === 'kyoto' 
                                                ? 'bg-indigo-100 text-indigo-600 shadow-md transform scale-[1.02]' 
                                                : 'bg-gray-100 text-gray-500 hover:bg-gray-200'
                                        }`}
                                    >
                                        äº¬éƒ½
                                    </button>
                                    <button
                                        onClick={() => setMapCategory('osaka')}
                                        className={`flex-1 py-3 rounded-lg font-bold transition-all ${
                                            mapCategory === 'osaka' 
                                                ? 'bg-rose-100 text-rose-600 shadow-md transform scale-[1.02]' 
                                                : 'bg-gray-100 text-gray-500 hover:bg-gray-200'
                                        }`}
                                    >
                                        å¤§é˜ª
                                    </button>
                                </div>

                                {mapCategory === 'kyoto' && (
                                    <div className="w-full bg-indigo-50 border-b border-indigo-100 px-2 py-2 flex gap-2 shrink-0 z-10 overflow-x-auto">
                                        {Object.values(KYOTO_SUBLOCATIONS).map(loc => (
                                            <button
                                                key={loc.id}
                                                onClick={() => setKyotoSubLocation(loc.id)}
                                                className={`flex-1 flex-shrink-0 px-3 py-1.5 rounded-full text-xs font-bold transition-colors border ${
                                                    kyotoSubLocation === loc.id
                                                        ? 'bg-indigo-600 text-white border-indigo-600'
                                                        : 'bg-white text-indigo-600 border-indigo-200 hover:bg-indigo-100'
                                                }`}
                                            >
                                                {loc.name}
                                            </button>
                                        ))}
                                    </div>
                                )}

                                {mapCategory === 'osaka' && (
                                    <div className="w-full bg-rose-50 border-b border-rose-100 px-2 py-2 flex gap-2 shrink-0 z-10 overflow-x-auto">
                                        {Object.values(OSAKA_SUBLOCATIONS).map(loc => (
                                            <button
                                                key={loc.id}
                                                onClick={() => setOsakaSubLocation(loc.id)}
                                                className={`flex-1 flex-shrink-0 px-3 py-1.5 rounded-full text-xs font-bold transition-colors border ${
                                                    osakaSubLocation === loc.id
                                                        ? 'bg-rose-600 text-white border-rose-600'
                                                        : 'bg-white text-rose-600 border-rose-200 hover:bg-rose-100'
                                                }`}
                                            >
                                                {loc.name}
                                            </button>
                                        ))}
                                    </div>
                                )}

                                <div className="w-full bg-gray-50 border-b border-gray-200 py-1 flex items-center justify-center relative z-10">
                                    <span className="text-xs font-bold text-gray-500 mr-4">
                                        å…±ç™¼ç¾ {filteredShops.length} å®¶åº—é‹ª
                                    </span>
                                    <button
                                        onClick={() => setIsDetailMenuOpen(!isDetailMenuOpen)}
                                        className="flex items-center gap-1 text-xs text-gray-500 hover:bg-gray-100 transition-colors px-2 py-1 rounded"
                                    >
                                        <span>è©³ç´°é¸å–®</span>
                                        {isDetailMenuOpen ? <IconChevronUp /> : <IconChevronDown />}
                                    </button>
                                </div>

                                <div className={`accordion-content bg-white shadow-sm z-10 ${isDetailMenuOpen ? 'open' : ''}`}>
                                    <div className={`filter-section border-b border-gray-100 flex ${isOtherAreaSelected ? 'closed' : 'open'}`}>
                                        <div className="w-1/2 border-r border-gray-100 p-2 flex flex-col items-center">
                                             <div className={`transition-all duration-300 overflow-hidden ${isOtherAreaSelected ? 'max-h-0 opacity-0' : 'max-h-20 opacity-100'}`}>
                                                 <div className="flex flex-wrap justify-center gap-1">
                                                    {DISTANCE_TYPES.map(d => (
                                                        <button
                                                            key={d.id}
                                                            onClick={() => setMapFilterDistance(d.id)}
                                                            className={`px-2 py-1 rounded-md text-[10px] font-bold transition-colors border ${
                                                                mapFilterDistance === d.id
                                                                    ? 'bg-green-200 text-green-900 border-green-600' // Dark green border
                                                                    : 'bg-white text-gray-500 border-gray-200 hover:bg-gray-50'
                                                            }`}
                                                        >
                                                            {d.label}
                                                        </button>
                                                    ))}
                                                 </div>
                                             </div>
                                             {isOtherAreaSelected && <span className="text-[10px] text-gray-300">ä¸é™è·é›¢</span>}
                                        </div>
                                        <div className="w-1/2 p-2 flex flex-col items-center justify-center">
                                             <div className="flex gap-1">
                                                <button
                                                    onClick={() => setMapFilterRating(mapFilterRating === 'over4' ? 'all' : 'over4')}
                                                    className={`px-2 py-1 rounded-md text-[10px] font-bold transition-colors border ${
                                                        mapFilterRating === 'over4'
                                                            ? 'bg-yellow-100 text-yellow-700 border-yellow-600' // Dark yellow border
                                                            : 'bg-white text-gray-500 border-gray-200 hover:bg-gray-50'
                                                    }`}
                                                >
                                                    â‰¥ 4.0 â˜…
                                                </button>
                                                <button
                                                    onClick={() => setMapFilterRating(mapFilterRating === 'top' ? 'all' : 'top')}
                                                    className={`px-2 py-1 rounded-md text-[10px] font-bold transition-colors border ${
                                                        mapFilterRating === 'top'
                                                            ? 'bg-yellow-200 text-yellow-800 border-yellow-600' // Dark yellow border
                                                            : 'bg-white text-gray-500 border-gray-200 hover:bg-gray-50'
                                                    }`}
                                                >
                                                    è©•åˆ†æœ€é«˜
                                                </button>
                                             </div>
                                        </div>
                                    </div>

                                    <div className="border-b border-gray-100 px-2 py-2 flex gap-2 overflow-x-auto scrollbar-hide items-center">
                                        {FILTER_TYPES.map(t => (
                                            <button
                                                key={t.id}
                                                onClick={() => setMapFilterType(t.id)}
                                                className={`px-4 py-1.5 rounded-full text-xs font-bold transition-colors border shrink-0 ${
                                                    mapFilterType === t.id
                                                        ? 'bg-black text-white border-black'
                                                        : 'bg-white text-gray-500 border-gray-200 hover:bg-gray-100'
                                                }`}
                                            >
                                                {t.label}
                                            </button>
                                        ))}
                                    </div>

                                    <div className="border-b border-gray-100 px-2 pb-2 pt-2 flex gap-2 justify-center">
                                        {SPECIAL_TYPES.map(s => (
                                            <button
                                                key={s.id}
                                                onClick={() => handleSpecialFilterClick(s.id)}
                                                className={`px-3 py-1 rounded-md text-xs font-bold transition-colors border ${
                                                    mapFilterSpecial.includes(s.id)
                                                        ? 'bg-orange-200 text-orange-900 border-orange-400'
                                                        : 'bg-white text-gray-500 border-gray-200 hover:bg-gray-50'
                                                }`}
                                            >
                                                {s.label}
                                            </button>
                                        ))}
                                    </div>
                                </div>
                                
                                <div className="flex-1 relative z-0">
                                    <MapView 
                                        center={currentCenter} 
                                        shops={filteredShops} 
                                    />
                                </div>
                            </div>
                        )}
                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
